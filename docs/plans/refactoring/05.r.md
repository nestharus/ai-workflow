Plan 05 – docs/dependency-patterns.md (Dependency Injection
Patterns)
Intro Proposal:
NOTE TO GENERATOR (DO NOT EMIT IN OUTPUT):

You are generating `docs/dependency-patterns.md`, one document in a FastAPI backend patterns series.

Global goals:
- Capture how FastAPI dependencies are defined, composed, and used across the app.
- Align with `fastapi-best-practices.md` / `fastapi-best-practices-2.md` and modern FastAPI docs.
- Use inline, general examples; avoid fragile references to specific modules or line numbers.

Specific scope for `dependency-patterns.md`:
- Explain FastAPI’s dependency injection model: `Depends()`, dependency trees, caching per request.
- Promote centralized dependency providers (e.g. `dependencies.py` modules) for services, settings, DB sessions, and clients.
- Show use of `Annotated[...]` type aliases for common dependencies to improve reusability and typing.
- Document request-scoped vs singleton dependencies (DB sessions vs Settings, connection pools, etc.).
- Show the `yield`-style dependencies for resources that need cleanup.
- Explain router-level dependencies for cross-cutting concerns (auth, rate limiting, logging).
- Describe how to override dependencies in tests (tie into the testing patterns document conceptually).

Out of scope:
- Router structure and API surface (in `router-patterns.md`).
- Implementation details of connection pools or repositories (in their own documents).

Begin the emitted documentation with the dependency patterns heading, not this meta intro.
Mistakes/Issues:
- File references and line numbers: Replace references like “move get_example_service from
  example.py line 15” with a general instruction (“Define all dependency provider functions in one module,
  e.g. move any inline get_xyz functions into app/api/v1/dependencies.py ”). The plan’s intent is right
  – just phrase it without relying on exact file line quotes. Likewise, “reference db_connections.py lines
  122-135 for acquire pattern” can be turned into a short example code snippet showing the yield context
  manager for a DB session.
- Potential confusion in example: The example CommonsDep = Annotated[dict,
  Depends(common_parameters)] is a bit abstract since common_parameters isn’t defined in the plan. If
  this comes from FastAPI docs, consider providing context or a different example. For instance, you could
  use an example of a common pagination params dependency:
  PageParams = Annotated[Pagination, Depends(common_pagination_params)]
  This would illustrate the concept of Annotated type aliases in a way readers recognize. Ensure examples
  have enough context so they’re understandable on their own.
- Ensure new module guidance: The plan suggests creating a new module app/api/v1/
  dependencies.py . The documentation should clearly instruct this (which it does). Just verify that nothing
  else in the docs conflicts with this new structure. For instance, Router Patterns now says to centralize
  dependencies in that module – that should be consistent.
  Missing Best Practices:
- Context about caching dependencies: It could be worth mentioning that FastAPI caches dependencies
  per request. For example, if two path operations both depend on get_db_session , it will only run once
  per request. This is a nice feature of the DI system. It might not be critical to the patterns doc, but it helps
  developers reason about performance of dependencies.
- Yield vs async generator: The doc touches on the yield pattern for cleanup (great). Perhaps also note
  that for async dependencies using yield , you should use async contextmanager or ensure proper
  exception handling around the yield. (FastAPI covers this, but a reminder wouldn’t hurt.)
- Avoid long dependency chains: The anti-pattern “over-nesting dependencies” is listed. You might add a
  rule of thumb: e.g. “Prefer at most 2-3 levels of nested dependencies.” This quantifies the guidance already
  there and echoes 2024 best practices to keep dependency graphs shallow.
- Security dependencies: Since this doc is about DI, perhaps briefly mention security dependencies (like
  OAuth2 password bearer or API key dependencies) as part of the ecosystem. Not in detail, but noting that
  they are just special cases of dependencies could be useful to readers, so they realize the same patterns
  apply (and these should also be centralized when possible).