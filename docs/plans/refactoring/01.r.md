Plan 01 – docs/api-patterns.md (API Design Patterns)
Intro Proposal:
NOTE TO GENERATOR (DO NOT EMIT IN OUTPUT):

You are generating `docs/api-patterns.md`, one document in a larger FastAPI backend patterns series.

Global goals for this documentation set:
- Document stable, 2024–2025 FastAPI + Pydantic v2 best practices for this backend.
- Favor inline, self-contained examples over references to specific files or line numbers.
- Use `fastapi-best-practices.md` and `fastapi-best-practices-2.md` as the primary source of truth.
- Treat `api-patterns-guide.md` as input that may contain mistakes; correct/normalize it when needed.

Specific scope for `api-patterns.md`:
- Define API-wide conventions: URL structure, versioning, liveness/readiness endpoints.
- Specify HTTP method and status code conventions (including validation errors).
- Define request/response modeling rules (Pydantic models, `ConfigDict(extra="forbid")`, response envelopes vs plain resources).
- Specify error-response shape at the HTTP layer and how it relates to global exception handling.
- Describe deprecation strategy, including `deprecated=True` in OpenAPI and HTTP headers such as `Sunset` (and optionally `Deprecation`).
- Clarify content negotiation basics (JSON, ORJSONResponse, compression) at the API contract level.

Out of scope for this file:
- Router organization details (APIRouter structure) – those live in `router-patterns.md`.
- Service, repository, and testing concerns – those have dedicated documents.

Start the actual documentation with the top-level heading for the API patterns document, not this note.
Mistakes/Issues:
- File references as examples: The plan points to code files (e.g. app/contracts/errors.py ) for
  patterns like error models. Instead, provide an inline example of the error response model or describe it
  abstractly. Relying on the reader to open that file is fragile. Similarly, references to specific line numbers
  (e.g. in router.py ) for documentation examples should be removed in favor of code snippets in the doc.
- Pagination model not defined: It advises using a generic Paginated[T] model for pagination but
  doesn’t show its fields. This could confuse readers. Add a brief example of Paginated[T] (e.g. with
  items: List[T], total: int, page: int, page_size: int ) so the structure is clear .
  Consistently using a generic Pydantic model for paginated responses is a best practice , but the
  documentation should include what that model looks like.
- Missing headers for deprecation: The plan correctly mentions marking deprecated endpoints and using
  the Sunset header for scheduled removal. It should also mention the Deprecation response header. It’s
  standard to include Deprecation: true or a deprecation date in responses as soon as an endpoint is
  deprecated, alongside Sunset for the final removal date . Including both headers provides a complete
  picture of the API lifecycle.
- HTTP status codes & trailing slash conventions: The status code guidelines are good (e.g. 400 for
  validation errors instead of 422). One thing to clarify is URL trailing slash conventions – e.g. decide if all
  endpoints should be defined without a trailing slash and rely on FastAPI’s redirect, or always with.
  Consistency here is part of API style. This wasn’t explicitly stated.
- JSON field naming and formats: The patterns don’t mention JSON key naming conventions (snake_case
  vs camelCase) or date/time formats. For completeness, specify that response models use e.g. snake_case
  keys (following Pydantic field names by default) and ISO 8601 timestamps in UTC for datetime fields. These
  are common API best practices to avoid ambiguity.
- Sunset header usage: Ensure to clarify that the Sunset header’s value should be a timestamp (RFC 1123
  date). For example: Sunset: Wed, 30 Jun 2025 23:59:59 GMT . This detail could prevent misuse of
  the header.
  Missing Best Practices:
- The Deprecation header as noted above is a missing piece. Also, consider mentioning the use of
  OpenAPI deprecated=True flag in the router decorators (which FastAPI supports) to mark deprecated
  endpoints in the docs (the plan hints at this but could be explicit).
- Consistency in Error Responses: The plan references using a structured HTTPValidationError for
  validation errors and an AppError model for others, but doesn’t explicitly say that all error responses
  should conform to a single shape. It’s implied, but stating it as a principle (e.g. “all error responses use the
  AppError schema with code , message , status_code ”) would reinforce consistency. It would also
  be wise to include an optional details field for additional error context, as some sources recommend
  .
- Minor organizational tweak: There is overlap with the Router Patterns doc (Plan 03) on OpenAPI
  documentation guidelines. To reduce duplication, you might let the API Patterns doc cover high-level
  documentation standards, and have the router-specific doc either omit those or reference the general
  guidelines. Right now both docs repeat that every endpoint needs summary/description/responses, which
  isn’t harmful but is redundant.