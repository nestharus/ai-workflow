Plan 03 – docs/router-patterns.md (APIRouter & Endpoint
Patterns)
Intro Proposal:
NOTE TO GENERATOR (DO NOT EMIT IN OUTPUT):

You are generating `docs/router-patterns.md`, one document in a FastAPI backend patterns series.

Global goals:
- Define how to structure routers, endpoints, and dependencies in FastAPI using 2024–2025 best practices.
- Use `fastapi-best-practices.md` and `fastapi-best-practices-2.md` as primary references; correct `api-patterns-guide.md` where it conflicts.
- Avoid referencing concrete file paths or line numbers; inline examples must be stable and generic.

Specific scope for `router-patterns.md`:
- Describe APIRouter organization (one router per domain/resource, versioned API packages).
- Define conventions for prefixes, tags, and router-level dependencies (auth, rate limits, logging).
- Show thin route handlers: validation → service call → response.
- Show standard usage of `Annotated` + `Depends()` for injecting services, settings, and other dependencies.
- Cover parameter modeling (path, query, header) and `response_model`, `status_code`, `summary`, `description`, and `responses` usage per route.
- Explain how routers cooperate with global error handling (services raise domain errors, routers don’t implement business logic).

Out of scope:
- Application factory and lifespan configuration (in `factory-patterns.md`).
- Low-level dependency definitions (in `dependency-patterns.md`).

Start the final documentation at the router patterns heading, not with this meta block.
Mistakes/Issues:
- Inline examples vs. references: As with others, remove direct references to example.py line numbers.
  For instance, the example of using Annotated[Service, Depends(get_service)] can be shown as a
  small code snippet in the doc. The same for “example.py lines 37-49 shows documentation” – better to
  provide a short illustrative snippet of a route with summary, response_model, etc., in the guide itself. This
  ensures the doc remains accurate even if example.py changes.
- “to be implemented” notes: The plan says “set router-level dependencies for shared auth/validation
  (to be implemented)”. While it’s fine to note future work, the documentation should focus on best practices
  assuming the ideal state. It might be better to phrase it as a recommendation (“…for shared auth/validation
  – use router-level dependencies for these common requirements”). This way the doc remains valid even if
  implementation is pending.
- Common responses: It briefly says “Set common responses for error documentation” but doesn’t
  elaborate. It may be useful to give an example (e.g. adding a default 404 response model to all routes via
  the router). Otherwise, readers might not know how to “set common responses.” If the intention is to utilize
  FastAPI’s responses parameter at the router include level, mention that explicitly.
  Missing Best Practices:
- Trailing slash behavior: Similar to Plan 01, consider specifying whether route definitions should include a
  trailing slash or not. FastAPI by default will redirect /resource to /resource/ if not found, but many
  APIs standardize one way or the other. Clarifying this in router patterns could improve consistency.
- Tag usage: The router doc mentions using tags for OpenAPI grouping (good). You might also specify
  that tags should be defined at router registration (as shown) or at the decorator level consistently. This is
  minor, but consistency helps the generated docs.
- Auth and security patterns: Router-level dependencies for things like Depends(verify_token) are
  mentioned. It might be worth noting as a best practice that authentication/authorization checks should
  typically be applied as dependencies at the router or route level. A short mention (with no need to detail
  implementation) would round out router patterns (since security is often a concern at the routing layer).
- Reference to dependency docs: Section 4 (Dependency Injection in Routers) overlaps with the dedicated
  Dependency Patterns doc (Plan 05). The content here is good in context, but ensure it doesn’t conflict.
  Possibly add a pointer like “(See Dependency Injection Patterns for common dependency definitions)” to
  connect the two docs. This avoids duplicating too much explanation.